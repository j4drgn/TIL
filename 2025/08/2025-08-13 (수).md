# 2025-08-13 (수)

## SQL DCL(Data Control Language) 학습

오늘은 SQL의 DCL(Data Control Language)에 대해 학습했습니다.

### 1. COMMIT과 ROLLBACK

- **COMMIT**
  - 트랜잭션 처리가 정상적으로 종료되는 상황에서 사용
  - 트랜잭션이 수행한 변경 내용을 데이터베이스에 반영하는 연산
  - COMMIT 이후에는 시스템 오류가 발생해도 변경사항이 취소되지 않음

- **ROLLBACK**
  - 트랜잭션 처리가 비정상적으로 종료된 경우 사용
  - 데이터베이스의 일관성이 깨졌을 때 트랜잭션이 진행한 변경작업을 취소하는 연산
  - 이전 상태로 되돌림
  - ROLLBACK되는 범위는 이전 COMMIT 이후부터 현재까지의 작업

- **주요 특징**
  - COMMIT 이전에 진행한 작업들은 ROLLBACK으로 취소 가능
  - COMMIT 이후에는 ROLLBACK으로 취소 불가능
  - 세션 종료(접속 해제) 시 COMMIT 여부를 물어볼 수 있음

### 2. 사용자 권한 관리

- **권한의 종류**
  - 시스템 권한: DBA 계정에 부여되는 권한 (사용자 생성/삭제, 모든 CREATE 권한 등)
  - 객체 권한: 특정 객체를 조작할 수 있는 권한 (DML 관련 권한)

- **ROLE(롤)**
  - 여러 개의 권한을 묶어놓은 것
  - 사용자에게 효율적으로 권한을 부여하기 위해 사용
  - 주요 롤:
    - CONNECT: ALTER SESSION, CREATE와 관련된 롤
    - RESOURCE: 사용자 객체 생성 및 접근 권한에 해당되는 롤
    - DBA: 슈퍼관리자 권한 모두 부여되는 롤

### 3. 사용자 계정 관리 (SYSTEM 계정 기준)

- **계정 생성**
  ```sql
  CREATE USER 계정명 IDENTIFIED BY "비밀번호"
      DEFAULT TABLESPACE USERS
      TEMPORARY TABLESPACE TEMP;
  ```

- **권한 부여**
  ```sql
  GRANT CONNECT, RESOURCE TO 계정명;
  ```

- **테이블스페이스 할당량 지정**
  ```sql
  ALTER USER 계정명 QUOTA UNLIMITED ON USERS; -- 무제한 활용
  ALTER USER 계정명 QUOTA 50M ON USERS; -- 50MB로 제한
  ```

- **비밀번호 변경**
  ```sql
  ALTER USER 계정명 IDENTIFIED BY 새비밀번호;
  ```

- **권한 회수**
  ```sql
  REVOKE CONNECT, RESOURCE FROM 계정명;
  ```

- **계정 삭제**
  ```sql
  DROP USER 계정명;
  DROP USER 계정명 CASCADE; -- 객체가 있는 경우
  ```

### 4. 객체 권한 관리

- **권한 부여 (소유주 계정에서)**
  ```sql
  GRANT SELECT ON 테이블명 TO 계정명;
  GRANT INSERT ON 테이블명 TO 계정명;
  GRANT UPDATE ON 테이블명 TO 계정명;
  GRANT DELETE ON 테이블명 TO 계정명;
  ```

- **권한 회수 (소유주 계정에서)**
  ```sql
  REVOKE SELECT ON 테이블명 FROM 계정명;
  ```

- **다른 계정의 객체 접근 (권한 부여 후)**
  ```sql
  SELECT * FROM 소유주계정.테이블명;
  ```

### 5. 정보 조회

- **계정 정보 조회**
  ```sql
  SELECT * FROM DBA_USERS; -- DBA 권한으로만 조회 가능
  SELECT * FROM ALL_USERS; -- DBA 권한보다 낮은 권한으로 조회 가능
  SELECT * FROM USER_USERS; -- 현재 계정에 대한 정보 조회
  ```

- **할당량 확인**
  ```sql
  SELECT * FROM USER_TS_QUOTAS; -- 할당량 MAX_BYTES 값이 -1이면 무제한
  ```

- **객체 정보 조회**
  ```sql
  SELECT * FROM DBA_TABLES; -- DBA 권한으로 확인 가능
  SELECT * FROM ALL_TABLES; -- 부여된 권한으로 조회할 수 있는 객체 확인
  SELECT * FROM USER_TABLES; -- 자신이 생성한 모든 객체에 대한 정보
  SELECT * FROM TAB; -- 현재 계정 DB 테이블 목록
  ```

- **권한 정보 조회**
  ```sql
  SELECT * FROM USER_ROLE_PRIVS; -- 현재 계정에 부여된 권한 조회
  SELECT * FROM DBA_ROLE_PRIVS WHERE GRANTEE = '계정명'; -- 특정 계정의 권한 조회
  SELECT * FROM DBA_SYS_PRIVS WHERE GRANTEE = '롤이름'; -- 롤에 부여된 권한 조회
  ```
